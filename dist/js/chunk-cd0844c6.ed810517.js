(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-cd0844c6"],{3248:function(e,t,n){},"421b":function(e,t,n){"use strict";var s=n("3248"),r=n.n(s);r.a},b0c0:function(e,t,n){var s=n("83ab"),r=n("9bf2").f,a=Function.prototype,o=a.toString,i=/^\s*function ([^ (]*)/,l="name";s&&!(l in a)&&r(a,l,{configurable:!0,get:function(){try{return o.call(this).match(i)[1]}catch(e){return""}}})},f859:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-row",{attrs:{gutter:10,type:"flex",justify:"center"}},[n("el-col",{attrs:{span:3}},[n("div",[n("el-select",{attrs:{"value-key":"value",clearable:"",filterable:"",placeholder:"選擇服務或搜尋"},model:{value:e.service,callback:function(t){e.service=t},expression:"service"}},e._l(e.services,(function(e){return n("el-option",{key:e.value,attrs:{label:e.name,value:e}})})),1)],1)]),n("el-col",{attrs:{span:4}},[n("div",[n("el-select",{attrs:{"value-key":"value",clearable:"",filterable:"",placeholder:"選擇國家或搜尋"},model:{value:e.country,callback:function(t){e.country=t},expression:"country"}},e._l(e.countrys,(function(t){return n("el-option",{key:t.value,attrs:{label:t.EName+t.CName+t.Code+"  $"+t.price,value:t}},[n("span",{staticStyle:{float:"left","font-size":"13px"}},[e._v(e._s(t.Code))]),n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.CName))]),n("span",{staticStyle:{float:"left"}},[e._v(e._s(t.EName))]),n("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s("$"+t.price))])])})),1)],1)]),n("el-col",{attrs:{span:1}},[n("div",[n("el-popconfirm",{attrs:{title:"確定取碼嗎?"},on:{onConfirm:e.getNumber}},[n("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[e._v("快速取碼")])],1)],1)])],1),e.errorInfo?n("div",[n("span",{staticStyle:{color:"red"}},[e._v(e._s(e.errInfo))])]):e._e(),n("el-row",{attrs:{type:"flex",justify:"center"}},[n("el-col",{attrs:{span:14}},[n("div",[this.numberData.length>0?n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.numberData,"row-class-name":e.tableRowClassName}},[n("el-table-column",{attrs:{prop:"time",label:"倒數時間"}}),n("el-table-column",{attrs:{prop:"country",label:"國家"}}),n("el-table-column",{attrs:{prop:"service",label:"服務",width:"90"}}),n("el-table-column",{attrs:{prop:"number",label:"號碼"}}),n("el-table-column",{attrs:{prop:"sms",label:"接收代碼",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isGetMessageButtonVisible?n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){return n.preventDefault(),e.handleGetMessage(t.$index,t.row)}}},[e._v("接收訊息")]):e._e(),""==!t.row.sms?n("el-input",{staticStyle:{width:"150px"},attrs:{size:"mini"},model:{value:t.row.sms,callback:function(n){e.$set(t.row,"sms",n)},expression:"scope.row.sms"}}):e._e()]}}],null,!1,2660119114)}),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isRestoreButtonEnabled?n("el-button",{attrs:{size:"mini"},on:{click:function(n){return n.preventDefault(),e.handleRestore(t.$index,t.row)}}},[e._v("回復")]):e._e(),t.row.isDeleteButtonEnabled?n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return n.preventDefault(),e.handleDelete(t.$index,t.row)}}},[e._v("刪除")]):e._e()]}}],null,!1,1667160824)})],1):e._e()],1)])],1)],1)},r=[],a=(n("b0c0"),{created:function(){this.userId=this.$route.params.userId},data:function(){return{errorInfo:!1,services:[{value:"opt37",name:"Line"}],service:"",countrys:[{value:"MY",Code:"+60",CName:"馬來西亞",EName:"Malaysia",price:35},{value:"ID",Code:"+62",CName:"印度尼西亞",EName:"Indonesia",price:30},{value:"PT",Code:"+351",CName:"葡萄牙",EName:"Portugal",price:30}],country:"",numberData:[]}},methods:{getNumber:function(){var e=this;""==this.service||""==this.country?(this.errorInfo=!0,this.errInfo="請選擇服務與國家"):(this.errorInfo=!1,this.errInfo="",this.$http.get("/api/user/"+this.userId+"/fund").then((function(t){var n=t.data.fund;if(!(n>=e.country.price))return e.errorInfo=!0,void(e.errInfo="餘額不足, 請確認儲值金額");e.$http.get("/api/smspva/getnumber",{params:{service:e.service.value,country:e.country.value}}).then((function(t){if("1"==t.data["response"]){var s=n-=e.country.price;e.$http.post("api/user/setAmountOfFund",{userId:e.userId,amount:s}).then((function(){e.$emit("updateHeader",{fund:s});var n={country:e.country.Code+e.country.CName+e.country.EName,service:e.service.name,countryAPICode:e.country.value,serviceAPICode:e.service.value,number:t.data.number,id:t.data.id};e.appendTable(n),e.startCountDown(e.numberData[e.numberData.length-1]),e.$message({message:"取碼成功, 從帳戶扣除"+e.country.price+"元",type:"success"})}))}else e.errorInfo=!0,e.errInfo="取碼失敗, 取消扣款, 請再試一次",console.error(t.data)})).catch((function(e){console.error(e)}))})).catch((function(e){console.error(e)})))},handleRestore:function(e,t){t.isEnabled=!0,t.isDeleteButtonEnabled=!0,t.isRestoreButtonEnabled=!1,t.isGetMessageButtonVisible=!0,t.sms=""},handleDelete:function(e,t){t.isEnabled=!1,t.isRestoreButtonEnabled=!0,t.isDeleteButtonEnabled=!1,t.isGetMessageButtonVisible=!1,t.sms=""},handleGetMessage:function(e,t){var n=this;this.$http.get("/api/smspva/getSms",{params:{country:t.countryAPICode,service:t.serviceAPICode,id:t.id}}).then((function(e){if("1"==e.data.response)t.sms=e.data.sms,t.isGetMessageButtonVisible=!1,t.isDeleteButtonEnabled=!1,t.isRestoreButtonEnabled=!1,t.isEnabled=!1,n.$message({message:"成功取得訊息!",type:"success"}),n.$http.get("/api/smspva/ban",{params:{service:t.serviceAPICode,id:t.id}});else if("2"==e.data.response){n.$message("未接收到訊息, 請20秒後再試一次");var s=2e4;t.isGetMessageButtonVisible=!1,t.sms="請20秒後再試一次";var r=window.setInterval((function(){if(s-=1e3,t.sms="請"+s/1e3+"秒後再試一次",t.isGetMessageButtonVisible=!1,0==s)return t.isGetMessageButtonVisible=!0,t.sms="請再試一次",void window.clearInterval(r)}),1e3)}else n.$message({message:"此號碼已超過時限或是完成訊息接收",type:"warning"}),t.isGetMessageButtonVisible=!1,t.isDeleteButtonEnabled=!1,t.isRestoreButtonEnabled=!1,t.isEnabled=!1,t.sms})).catch((function(e){console.error(e)}))},tableRowClassName:function(e){var t=e.row;return t.isEnabled?"":"deleted-row"},startCountDown:function(e){var t=window.setInterval((function(){e.timer-=1e3;var n=Math.floor(e.timer/1e3/60%60),s=Math.floor(e.timer/1e3%60);if(e.time=(n<10?"0"+n:n)+":"+(s<10?"0"+s:s),0==e.timer)return window.clearInterval(t),e.isEnabled=e.isRestoreButtonEnabled=e.isDeleteButtonEnabled=e.isGetMessageButtonVisible=!1,void(e.sms="")}),1e3)},appendTable:function(e){this.numberData.push({id:e.id,time:"10:00",timer:6e5,country:e.country,number:e.number,countryAPICode:e.countryAPICode,service:e.service,serviceAPICode:e.serviceAPICode,sms:"",isEnabled:!0,isRestoreButtonEnabled:!1,isDeleteButtonEnabled:!0,isGetMessageButtonVisible:!0})}}}),o=a,i=(n("421b"),n("2877")),l=Object(i["a"])(o,s,r,!1,null,null,null);t["default"]=l.exports}}]);
//# sourceMappingURL=chunk-cd0844c6.ed810517.js.map